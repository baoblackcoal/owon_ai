# **OWON 仪器仪表 AI 助手 - Phase 1: 核心MVP需求文档**

## 1. 项目概述

构建一个面向利利普（Owon）产品用户的AI助手网页应用。该应用以AI多模态问答为核心，无缝集成了人工支持渠道，并包含强大的后台管理与数据分析功能，旨在为Owon用户提供前所未有的智能化、个性化服务体验。

### 1.1. 核心价值

- **提升用户支持效率**：通过AI助手提供7x24小时即时响应，自动化解答大部分常见及复杂的使用问题，显著降低人工客服的压力。当AI无法满足用户时，无缝转接到人工服务，形成支持闭环。
- **增强用户体验**：提供包括文字、图片、语音在内的多模态交互方式，让用户可以更直观、便捷地提问。流式输出、富文本格式和个性化账户系统共同打造流畅、现代的用户体验。
- **数据驱动决策**：通过深度分析用户的提问热点、反馈（点赞/点踩）和行为数据，精准洞察用户的核心痛点与潜在需求，为产品迭代、文档优化和市场策略提供坚实的数据支持。

### 1.2. 目标用户

- **专业工程师与技术人员**：在使用Owon仪器进行测试、调试时遇到具体操作或技术规格问题的核心用户。
- **教育用户与学生**：在学习和实验中使用Owon仪器的学生和教师。
- **业余爱好者与创客**：在个人项目中使用Owon仪器的非专业用户。

## 2. 技术栈

| 类别 | 技术/服务 | 理由 |
| :--- | :--- | :--- |
| **前端** | 原生JavaScript + Django模板 | 使用原生JavaScript提供交互功能，结合Django模板系统，代码简洁可控，便于调试和维护，无需复杂的前端构建工具。 |
| **样式** | Tailwind CSS (CDN) | 提供原子级的CSS类，能快速构建现代化界面，CDN方式简化了前端构建流程。 |
| **后端框架** | Django | 成熟稳定，拥有强大的生态和"开箱即用"的管理后台，能快速开发健壮的后端服务。 |
| **数据库** | Supabase PostgreSQL | 开发和生产环境统一使用Supabase，提供实时功能、统一管理和高性能PostgreSQL数据库，简化环境配置和部署。 |
| **编程语言** | Python | Django的开发语言，同时也是AI和数据分析领域的主流语言，便于后端逻辑和AI服务的粘合。 |
| **AI服务** | 阿里云百炼大模型服务 | 成熟的商业化大模型服务，提供稳定的API和强大的多模态能力，能满足项目对问答质量和图片理解的需求。 |
| **文件存储** | Supabase Storage | 与数据库集成的云存储服务，支持图片、音频等多媒体文件存储，提供CDN加速和权限控制。 |
| **环境配置** | 统一配置 | 开发和生产环境使用相同的Supabase配置，消除环境差异，提升开发效率和部署可靠性。 |

### 2.1. Supabase分支管理环境配置

采用Supabase的分支管理功能来区分开发和生产环境，实现安全高效的数据库迁移管理：

#### 分支管理概念
- **生产分支 (Production Branch)**: 对应线上正在运行的数据库，包含真实用户数据
- **开发分支 (Development Branch)**: 用于开发新功能和修复问题的数据库副本
- **分支隔离**: 确保开发过程中的实验性更改不会直接影响生产环境

## 3. Phase 1 MVP功能需求

### 3.1. 核心问答功能（仅限文字）

#### 3.1.1. 文字智能问答
- **输入支持**: 标准文本输入框，支持多行文本输入
- **回复支持**:
  - **流式输出 (Streaming)**: AI的文字回复必须以打字机效果逐字流式显示
  - **富文本格式**: 以Markdown格式进行渲染，支持代码块、列表、表格、链接等，提升阅读体验
- **交互反馈**:
  - **点赞/点踩**: 每个AI回答后都附有"👍"和"👎"按钮
    - **点赞**: 增加该问答对的权重，用于后续排行榜计算
    - **点踩**: 触发反馈流程，弹窗询问用户不满意原因，并提供【转人工服务】按钮

### 3.2. 用户系统

#### 3.2.1. 游客与注册用户权限
- **游客 (Guest)**:
  - 无需注册即可开始对话
  - 每日有 **20次** 对话限制
  - 对话历史仅在当前浏览器会话中保留（使用localStorage）
  - **无法**使用"转人工服务"功能
- **注册用户 (Registered User)**:
  - **触发注册**: 当游客尝试进行第21次对话，或点击"转人工服务"时，系统会弹窗引导用户注册
  - **注册方式**: 使用邮箱和密码进行注册，需要进行邮箱验证
  - **权限**:
    - 无对话次数限制
    - 享有完整的个人中心功能（永久历史记录）
    - 可以请求人工支持

#### 3.2.2. 个人中心（基础版）
- **问答历史**: 按时间倒序展示用户所有提问和AI/人工的回答
- **账户管理**: 允许用户修改密码、管理个人信息

### 3.3. 人工支持工作流

- **触发**: 用户在点踩AI回答后，选择"转人工服务"
- **队列**: 该请求（包含完整的上下文对话）被标记并进入管理员后台的"待处理工单"队列
- **处理**: 客服/技术支持人员在后台查看工单，进行回复
- **通知**: 回复后，系统通过邮件通知用户，用户的提问在个人中心会显示"已由人工回复"状态

### 3.4. 问答排行榜功能

#### 3.4.1. 热门问题排行榜
- **排行榜计算**: 基于点赞数、回答质量、问题频率等多维度权重计算热门问题
- **实时更新**: 排行榜数据定时更新，展示最新的热门问题趋势
- **分类展示**: 
  - **本周热门**: 展示最近7天内的热门问题
  - **全部时间**: 展示历史上最热门的问题
  - **我的关注**: 注册用户可以关注感兴趣的问题分类

#### 3.4.2. 排行榜展示
- **问题列表**: 按热度排序展示问题标题、点赞数、回答次数
- **问题详情**: 点击问题可查看完整的问题描述和AI最佳回答
- **互动功能**: 
  - 用户可以对排行榜中的问题进行点赞
  - 可以基于热门问题发起新的相关提问
  - 支持分享热门问题到社交媒体

#### 3.4.3. 数据统计价值
- **用户需求洞察**: 通过热门问题分析用户最关心的技术问题
- **产品优化建议**: 为产品团队提供用户痛点数据支持
- **知识库构建**: 热门问题可作为知识库文档的重要来源

### 3.5. 管理员后台（基础版）

#### 3.5.1. 安全与权限
- **独立登录**: 管理员使用独立的、受保护的后台登录入口
- **基础权限**: 基于Django权限系统实现基础权限管理

#### 3.5.2. 基础管理功能
- **用户列表**: 查看所有注册用户，支持按用户名、邮箱搜索
- **问答流监控**: 查看系统中实时发生的问答，用于监控，支持按点赞/点踩进行过滤
- **问答排行榜管理**: 
  - 查看和管理热门问题排行榜
  - 支持手动置顶或隐藏特定问题
  - 排行榜算法参数调整
- **人工支持工单**:
  - **待处理**: 清晰的工单队列，按时间排序
  - **处理中/已完成**: 工单状态管理和历史归档

## 4. 系统架构概览

1. **用户浏览器**: 渲染Django模板页面，通过原生JavaScript处理用户交互。用户的文本输入通过Ajax/Fetch请求发送到Django后端。
2. **Django后端**:
   - 接收前端请求，处理业务逻辑
   - **认证**: 使用Django内置认证系统验证用户身份
   - **分支管理**: 根据环境变量自动连接到相应的Supabase分支（开发/生产）
   - **数据读写**: 通过Django ORM与当前分支的Supabase PostgreSQL数据库交互，存取问答记录、用户信息等
   - **AI调用**: 构造Prompt，通过API调用阿里云百炼大模型服务，并以流式方式将结果返回给前端
3. **Supabase分支架构**:
   - **生产分支 (main)**: 线上环境数据库
   - **开发分支 (develop)**: 开发环境数据库副本
   - **迁移跟踪**: 基础的迁移版本控制机制
4. **阿里云百炼**: 接收来自Django后端的API请求，执行AI计算（文本生成），并返回结果

## 5. 非功能性需求

| 需求类别 | 具体要求 |
| :--- | :--- |
| **性能** | - 页面主要内容加载时间 (LCP) < 2.5秒<br> - AI回复首个字符响应时间 < 1.5秒<br> - 系统应能支持至少50个并发用户流畅使用 |
| **安全性** | - 所有用户输入必须经过严格的清理和验证，防止XSS、SQL注入等攻击<br> - 用户密码必须经过哈希加盐存储<br> - 前后端所有通信使用HTTPS加密 |
| **可用性** | - 界面设计简洁直观，符合用户习惯<br> - 响应式设计，在主流桌面和移动设备浏览器上均有良好体验<br> - 提供清晰的错误提示和操作引导 |

## 6. Phase 1 实现目标

### 6.1. 核心目标
- **目标**: 快速上线核心问答功能，验证市场可行性
- **预计时间**: 1-2个月

### 6.2. 具体功能交付
- 游客与用户注册/登录系统（邮箱+密码）
- **仅限文字**的AI问答，支持流式输出和Markdown渲染
- 对话历史记录（仅限注册用户）
- AI回答的点赞/点踩功能
- **问答排行榜功能**：热门问题展示、多维度排序、用户互动
- 基础的管理员后台：能查看所有用户和问答流（点赞，点踩的过滤）
- 上线**人工支持工作流**（请求、后台处理、邮件通知）

### 6.3. Supabase分支管理
- 建立生产分支(main)和开发分支(develop)的基础架构
- 建立基础的分支创建和合并工作流程
- 实现基本的迁移管理和版本控制

## 7. 技术实现要点

### 7.1. 流式输出实现
- 使用Server-Sent Events (SSE) 或 WebSocket 实现AI回复的流式输出
- 前端实现打字机效果的逐字显示
- 支持Markdown的实时渲染

### 7.2. 用户系统
- Django内置User模型扩展
- 基于session的认证机制
- 邮箱验证功能

### 7.3. 数据库设计
- 用户模型扩展
- 对话会话模型
- 消息模型
- 人工支持工单模型
- 问答排行榜模型（热门问题、点赞统计、排行榜缓存）

### 7.4. AI服务集成
- 阿里云百炼API集成
- 错误处理和重试机制
- API调用限流和监控 